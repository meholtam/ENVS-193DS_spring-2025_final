---
title: "Mary Holtam Final"
author: "Mary Holtam"
output: html_document
date: "2025-06-08"
---

Link to GitHub repository: https://github.com/meholtam/ENVS-193DS_spring-2025_final.git

```{r set up, message=FALSE, warning=FALSE}
#making sure no messages show when loading in packages
library(tidyverse)
library(here)
library(gt)
library(ggplot2)
library(readxl)
library(dplyr)
library(DHARMa)
library(lubridate)
library(janitor)
sst <- read_csv("~/Desktop/ENVS-193DS/ENVS-193DS_spring-2025_final/data/sst.csv") # reading in my data
nest_boxes <- read_csv("~/Desktop/ENVS-193DS/ENVS-193DS_spring-2025_final/data/occdist.csv")
```


ˆ
Problem 1: Research Writing 

a) Transparent statistical methods
In part 1, my coworker used a Pearson correlation test. Because the results section details that the correlation between distance from head water and annual total nitrogen load was being measured, we know that a correlation test was being used. In part 2, the coworker used a one-way ANOVA test. Here, the average nitrogen load was measured across sources, including urban land, atmospheric deposition, fertilizer, wastewater treatment, and grasslands, which points to the use of an ANOVA test which looks at means across variables from unrelated groups.

b) More information needed
A piece of information from the ANOVA test that would provide greater context for the results would be the effect size. This would help demonstrate what proportion of variance in nitrogen load each source type provides. A second helpful piece of information would be the group mean for each source, which would provide the average nitrogen load that each source contributes. This would allow readers to understand which sources, from urban land to grasslands, cause the greatest amount of pollution. 

c) Suggestions for rewriting
Statement 1- We found that total nitrogen load (kg year-1) increased as distance from the headwater (km) decreased, suggesting that upstream locations supply more nitrogen input. (Correlation test: r= correlation coefficient, p= 0.03, α = significance level, n= sample size). 

Statement 2- Each source measured contributed a different average nitrogen load (kg year-1), with urban land, fertilizer, and wastewater treatment contributing significantly more nitrogen than atmospheric deposition and grassland sources. (One-Way ANOVA: F(df1, df2) = F-statistic, p = 0.02, α = [significance level], distribution = F-distribution, n= sample size). 

Problem 2: Data Visualization

```{r cleaning data}
sst_clean <- sst |>  # cleaning sst data
  mutate(
    year = factor(year(date), levels = c("2018", "2019", "2020", "2021", "2022", "2023")),  # comma after year(date)
    month = month(date, label = TRUE, abbr = TRUE)  # comma was missing, but this is last argument so no comma needed here
  ) |>
  filter(year %in% c("2018", "2019", "2020", "2021", "2022", "2023")) |>  # filter years of interest
  group_by(year, month) |>  # groups data by year and month
  summarize(mean_monthly_sst = round(mean(temp, na.rm = TRUE), 1), .groups = "drop")  # calculates mean SST per month

sst_clean |> slice_sample(n = 5)

str(sst_clean)

```

b. Visualize the data
```{r line graph}
ggplot(data = sst_clean, # sets the data frame
       aes(x = month, # the x-axis should be date
           y = mean_monthly_sst, # the y-axis should be total_rain
           color = year, # color all geometries by water_year
           group = year)) + # tell ggplot how to group the data for the lines  
  geom_point() + # adding points
  geom_line() + # adding lines
  scale_color_manual(values = c(
    "2018" = "cadetblue1",
    "2019" = "skyblue",
    "2020" = "dodgerblue",
    "2021" = "royalblue",
    "2022" ="mediumblue",
    "2023" = "midnightblue"
  )) + #changing the colors of each line to a blue gradient
 theme(
   panel.background = element_blank(), # Makes the panel background transparent/blank
   panel.border = element_rect(color = "black", fill = NA, linewidth = 1), # add black border
    axis.line = element_blank(), # Removes both x and y axis lines
    plot.margin = margin(20, 20, 20, 20), # make it so graph does not get cut off
    axis.ticks = element_blank(), # Removes all axis ticks
    legend.position = c(0.05, 0.95), # move legend to the top left
    legend.justification = c(0, 1), # move legend to top left
    coord_cartesian(clip = "off") # prevent legend from being cut off
  ) +
  labs(x = "Month", # relabeling the x-axis
       y = "Mean monthly sea surface temperature (°C)", # relabeling the y-axis
       color = "Year") # relabeling the legend
```


Problem 3: Data Analysis

a) Response variable
In this data set, the 1s and 0s refer to whether a certain species is occupying the box, or if there is a different species/if the box is empty. The 1 in the sp column refers to the presence of a swift parrot and the 0 refers to it being occupied by a different species or being empty; the 1 in ths cs column refers to the common starling and the 0 refers to it being occupied by a different species or being empty; the 1 in the e column refers to it being unoccupied or empty and the 0 refers to it being occupied; and the 1 in the tm column refers to it being occupied by the tree martin and the 0 refers to another species.

b) Purpose of study
The target species for the nest boxes being studied in this paper is the swift parrot, where the common starling and the tree martin are non-target species that may be occupying the nest boxes. The common starling and tree martin are competitors of the swift parrot for this habitat and are the main beneficiaries of the boxes, so this study seeks to identify what factors cause greater occupancy of these competitors over the intended beneficiary, the swift parrot. 

c) Difference in "seasons"
The two years that are referred to as seasons are 2016 and 2019. The main difference between these years in the context of this study is that in 2016 the boxes were newly deployed where in 2019 they had been established and present for three years. 

d) Table of models
 Model number | Season | Distance to forest edge | Model Description                             |       
|:------------:|:------:|:-----------------------:|:---------------------------------------------:|
| 0            |No      |No                       |no predictors(null model)                      |
| 1            |Yes     |Yes                      |all predictors(saturdated model)               |
| 2            |Yes     |No                       |GLM:Predictor variable=season                  |
| 3            |No      |Yes                      |GLM:Predictor variable=distance to forest edge |


e) Run the models
```{r cleaning data}
nest_boxes_clean <- nest_boxes |> 
  clean_names()
```

```{r, results='hide', message=FALSE, warning=FALSE}
# model 0: null model
model0 <- glm( #using GLM
  sp ~ 1, # formula, null so using no predictor
  data = nest_boxes_clean, # data frame
  family = binomial 
)

# model 1: all predictors/saturated
model1 <- glm(
  sp ~ season * edge_distance, # formula using season and edge distance as predictors
  data = nest_boxes_clean, # data frame
  family = binomial
)

# model 2: season
model2 <- glm(
  sp ~ season, # formula using season as predictor
  data = nest_boxes_clean, #data frame
  family = binomial
)

# model 3: distance to forest edge
model3 <- glm(
  sp ~ edge_distance, # formula using edge distance as predictor
  data = nest_boxes_clean, #data frame
  family = binomial
)

```


f) Check the diagnostics
```{r model 0}
#model 0 diagnostics: 
res0 <- simulateResiduals(model0)
plot(res0)

```

```{r model 1}
#model 1 diagnostics
res1 <- simulateResiduals(model1)
plot(res1)

```

```{r model 2}
#model 2 diagnostics
res2 <- simulateResiduals(model2)
plot(res2)

```

```{r model 3}
#model 3 diagnostics
res3 <- simulateResiduals(model3)
plot(res3)
```


g) Select the best model
The best model can be described by the Akaike's Information Crierion, or AIC. Looking at this, the best model would be Model 1, which looks at edge distance and season as predictors, as the AIC is 227.0325. The response variable for Model 1 is occupancy of the swift parrot. Therefore, looking at both edge distance and season is the best way to determine the occupancy of the swift parrot in the nest boxes. 


```{r model-selection}
AICc(model1, #using AIC to run model selection
     model2,
     model3,
     model0)|> 
  # arranging output in descending order of AIC
  arrange(AICc)
```


h) Visualize the model predictions
```{r visualize model prediction}
mod_pres <- ggpredict(model1, terms = c("edge_distance, [0:1100 by=10]", "season"))
ggplot(nest_boxes_clean, # creates base ggplot object using clean data
       aes(x = edge_distance, 
           y = sp)) + # sets aesthetic so that x is equal to the distance from forest edge and y is equal to the species presence
  geom_point(size = 3, # makes points larger than default
             alpha = 0.4, # makes points semi-transparent
             color = "#40E0D0") + # making point color turquoise
  geom_ribbon(data = mod_preds, # adds confidence ribbon using model prediction data 
              aes(x = x, 
                  y = predicted, # maps predicted values and the bounds of their confidence 
                  ymin = conf.low, 
                  ymax - conf.high),
              fill= "#8B8B00", alpha = 0.3) + # makes ribbon yellow-green and translucent
  geom_line(data = mod_preds, # adds prediction line
            aes(x = x,
                y = predicted),
            color = "#5008B8", size = 1.2) + # makes line purple and thicker than default
scale_y_continuous(
  name = "Probability of Swift Parrot Occupancy in Nest Boxes", # Naming y-axis label in full 
  limits = c(0,1), # fixes axis from 0 to 1 
  breaks = c(0,1) + # only shows tick marks at 0 and 1
    scale_x_continuous(
      name = "Distance from Forest Edge" # naming x-axis label in full 
    ) +
    theme_minimal(base_size = 14) + # applies minimal theme and sets base font size to 14 to make it easier to read
    theme(
      panel.grid = element_blank(), # Remove all gridlines
      axis.title = element_text(face = "bold"), # makes axis titles bold
      legend.position = "none" # hides legend 
    ))
```


i) Write a caption for your figure

Figure 1.




j) Calculate model predictions

k) Interpret your results

Problem 4: Affective and exploratory visualizations

a) Comparing visualizations 
















